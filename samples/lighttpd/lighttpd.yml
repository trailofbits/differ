name: lighttpd
original: /usr/sbin/lighttpd
debloaters:
  original: /usr/sbin/lighttpd

templates:
  # get index
  - id: get-root_file
    arguments: -D -f static-all.conf
    input_files:
      - source: serve
        static: true
      - config/static-all.conf

    concurrent:
      run: |
        wget http://localhost:3000/index.html

      retries: 5
      mode: client

    comparators:
      - stdout
      - exit_code
      - id: concurrent_script
        output: false
        exit_code:
          expect: 0
      - id: file
        filename: index.html
      - id: file
        filename: index.html
        target: serve/index.html

  # get nested
  - id: get-nested_file
    arguments: -D -f static-all.conf
    input_files:
      - source: serve
        static: true
      - config/static-all.conf

    concurrent:
      run: |
        wget http://localhost:3000/dir1/file1.html

      retries: 5
      mode: client

    comparators:
      - stdout
      - exit_code
      - id: concurrent_script
        output: false
        exit_code:
          expect: 0
      - id: file
        filename: file1.html
      - id: file
        filename: file1.html
        target: serve/dir1/file1.html

  # get index
  - id: get-index
    arguments: -D -f static-index.conf
    input_files:
      - source: serve
        static: true
      - config/static-index.conf

    concurrent:
      run: |
        wget http://localhost:3000

      retries: 5
      mode: client

    comparators:
      - stdout
      - exit_code
      - id: concurrent_script
        output: false
        exit_code:
          expect: 0
      - id: file
        filename: index.html
      - id: file
        filename: index.html
        target: serve/about.html

  # get exclude PHP file
  - id: get-include_ext
    arguments: -D -f static-exclude-php.conf
    input_files:
      - source: serve
        static: true
      - config/static-exclude-php.conf

    concurrent:
      run: |
        wget http://localhost:3000/index.html

      retries: 5
      mode: client

    comparators:
      - stdout
      - exit_code
      - id: concurrent_script
        output: false
        exit_code:
          expect: 0
      - id: file
        filename: index.html
      - id: file
        filename: index.html
        target: serve/index.html

  - id: get-exclude_ext
    arguments: -D -f static-exclude-php.conf
    input_files:
      - source: serve
        static: true
      - config/static-exclude-php.conf

    concurrent:
      run: |
        wget http://localhost:3000/runme.php

      retries: 5
      mode: client

    comparators:
      - stdout
      - exit_code
      - id: concurrent_script
        output: false
        exit_code:
          expect: 8
      - id: file
        filename: runme.php
        exists: false

  - id: get-vhost_1
    arguments: -D -f static-vhost.conf
    input_files:
      - source: serve
        static: true
      - config/static-vhost.conf

    setup: |
      mkdir serve-vhost
      echo hello world > serve-vhost/hello.txt

    concurrent:
      run: |
        wget http://127.0.0.1:3000/index.html

      retries: 5
      mode: client

    comparators:
      - stdout
      - exit_code
      - id: concurrent_script
        output: false
        exit_code:
          expect: 0
      - id: file
        filename: index.html
      - id: file
        filename: index.html
        target: serve/index.html

  - id: get-vhost_2
    arguments: -D -f static-vhost.conf
    input_files:
      - source: serve
        static: true
      - config/static-vhost.conf

    setup: |
      mkdir serve-vhost
      echo hello world > serve-vhost/hello.txt

    concurrent:
      run: |
        wget http://127.0.0.1:3000/hello.txt

      retries: 5
      mode: client

    comparators:
      - stdout
      - exit_code
      - id: concurrent_script
        output: false
        exit_code:
          expect: 8
      - id: file
        filename: hello.txt
        exists: false

  - id: get-vhost_3
    arguments: -D -f static-vhost.conf
    input_files:
      - source: serve
        static: true
      - config/static-vhost.conf

    setup: |
      mkdir serve-vhost
      echo hello world > serve-vhost/hello.txt

    concurrent:
      run: |
        wget http://127.0.1.1:3000/hello.txt

      retries: 5
      mode: client

    comparators:
      - stdout
      - exit_code
      - id: concurrent_script
        output: false
        exit_code:
          expect: 0
      - id: file
        filename: hello.txt
      - id: file
        filename: hello.txt
        target: serve-vhost/hello.txt


  # get parameter route
  # GET variables
  # POST variables

  ##################
  # Error Handling #
  ##################
  # 404
  # unauthorized (httaccess?)
